{"tags": ["json", "azure", "azure-data-factory", "azure-data-lake"], "answers": [{"comments": [{"score": 0, "creation_date": 1612255088, "post_id": 66003195, "comment_id": 116702513, "body": "Xu thank you, your solution seems to be working to this point! I have created a Copy Data block inside the Execute Pipeline, and I would then like to refer to key_1 and key_2 inside the Copy Data Source: <code>@concat(Pip_Object.key_1,&#39;?&#39;,join(Pip_Object.key_2,&#39;&amp;&#39;))</code> but this code is not working. Can you help me with referring to the JSON keys inside Copy Data?"}, {"score": 0, "creation_date": 1612255811, "post_id": 66003195, "comment_id": 116702795, "body": "do you know if there is a solution for my problem that does not include selecting item from the Pip_object Object?"}, {"score": 1, "creation_date": 1612255840, "post_id": 66003195, "comment_id": 116702808, "body": "I&#39;m a little confused about that, do you want to convert this json array into a query string for the Rest API?"}, {"score": 1, "creation_date": 1612256528, "post_id": 66003195, "comment_id": 116703115, "body": "Maybe you can post another question to clarify the process of your Copy activity. I will try to find out."}, {"score": 0, "creation_date": 1612262411, "post_id": 66003195, "comment_id": 116705698, "body": "Thank you, you are very kind! I actually figured the referring part out: it should be <code>@concat(pipeline().parameters.Pip_Object.key_1,&#39;?&#39;,join(pipe&zwnj;&#8203;line().parameters.Pi&zwnj;&#8203;p_Object.key_2,&#39;&amp;&#39;))</code> so I was just missing pipeline().parameters. in front of the keys"}, {"score": 0, "creation_date": 1612281034, "post_id": 66003195, "comment_id": 116714643, "body": "Xu Yes, I will. Do you know how I could change the filename of my file in Copy Data --&gt; Sink --&gt; Dataset Properties --&gt; Filename, so that it would pick <b>value_1</b> as my filename? At the moment I have <code>pipeline().parameters.Pip_Object.key_1</code> in the filename field and the file in Data Lake is renamed to &quot;pipeline().parameters.Pip_Object.key_1.json&quot;"}, {"score": 1, "creation_date": 1612314947, "post_id": 66003195, "comment_id": 116726755, "body": "Hi @jeppoo1, please see my updated answer."}, {"score": 1, "creation_date": 1612340007, "post_id": 66003195, "comment_id": 116732711, "body": "Hi @Joseph Xu that was exactly what I was looking for! Thank you!"}], "score": 1, "last_activity_date": 1612314907, "last_edit_date": 1612314907, "answer_id": 66003195, "question_id": 65995392, "body": "<p><strong>update:</strong><br />\nIf you want change the filename  in Copy Data --&gt; Sink.\n<a href=\"https://i.stack.imgur.com/Ytp5B.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Ytp5B.png\" alt=\"enter image description here\" /></a>\nYou can key in the dynamic content <code>@concat(pipeline().parameters.Pip_Object.key_1,'.json')</code> to rename the file.\n<a href=\"https://i.stack.imgur.com/XfhG6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/XfhG6.png\" alt=\"enter image description here\" /></a></p>\n<p><strong>Please correct me if I understand you wrong.</strong></p>\n<hr />\n<ol>\n<li><p>First, we should use <strong>Parameters</strong> to store the Json array as follows. Because <strong>Variables</strong> are not support to store the Json array. <strong>Variables</strong> are only support to store simple data type such as <code>[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;...]</code>.<br />\n<a href=\"https://i.stack.imgur.com/y4gpw.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/y4gpw.png\" alt=\"enter image description here\" /></a></p>\n</li>\n<li><p>Json array format should as follows:<br />\n[{&quot;key_1&quot;: &quot;value_1&quot;},{&quot;key_2&quot;: [&quot;value_2_1&quot;,&quot;value_2_2&quot;]}]</p>\n</li>\n<li><p>I created a simple test here. Then ForEach the Json array:<br />\n<a href=\"https://i.stack.imgur.com/Tzc0O.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Tzc0O.png\" alt=\"enter image description here\" /></a></p>\n</li>\n<li><p>Inside <code>ForEach1</code> activity, pass <code>@item()</code> to the object type parameter <code>Pip_Object</code>.<br />\n<a href=\"https://i.stack.imgur.com/ZHsiG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ZHsiG.png\" alt=\"enter image description here\" /></a></p>\n</li>\n<li><p>The Input is as follows:<br />\n<a href=\"https://i.stack.imgur.com/FVyZk.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/FVyZk.png\" alt=\"enter image description here\" /></a></p>\n</li>\n</ol>\n"}, {"score": 0, "last_activity_date": 1613549284, "answer_id": 66237955, "question_id": 65995392, "body": "<p>We ended up using two pipelines: a generic one and a specific one.</p>\n<p>The generic one has the JSON as a parameter (JSON_PARAMETER), and we set it a default value in the following form</p>\n<pre><code>[{&quot;key_1&quot;:&quot;value_1&quot;,&quot;key_2&quot;:[&quot;value_2&quot;]},{&quot;key_1&quot;:&quot;value_3&quot;,&quot;key_2&quot;:[&quot;value_2&quot;]}, ...etc. ...}]\n</code></pre>\n<p>The generic pipeline has a forEach loop, in which that mentioned JSON parameter is called in Settings -&gt; Items:</p>\n<pre><code>@JSON(pipeline().parameters.JSON_PARAMETER)\n</code></pre>\n<p>In the specific pipeline, there is an Execute Pipeline activity, where the JSON_PARAMETER is found in Settings -&gt; Parameters. If the default value of JSON_PARAMETER is used, the field is left blank. If we want to change the parameter, before Execute Pipeline, we put a Set Variable activity where we change the Variables -&gt; Value to:</p>\n<pre><code>@concat('\n[\n    {&quot;key_1&quot;:&quot;value_1&quot;,\n     &quot;key_2&quot;:\n            [&quot;value_2&quot;,\n             &quot;value_3&quot;\n            ]\n     },\n     {&quot;key_1&quot;:&quot;value_3&quot;,\n\n    ...and so on...\n\n    }\n]\n')\n</code></pre>\n"}], "is_answered": true, "answer_count": 2, "score": 1, "last_activity_date": 1613549284, "creation_date": 1612193157, "question_id": 65995392, "title": "Azure Data Factory - forEach - JSON to array errors", "body": "<p>My aim is to use Azure Data Factory to copy data from one place to another using REST API.\nThe first part of the copying is using the ForEach activity to select parameters from a nested JSON/array. I have had problems with this nested JSON because of various error messages in the ForEach activity.</p>\n<p>My JSON is of the following form:</p>\n<pre><code>(\n    {\n        &quot;key_1&quot;: &quot;value_1&quot;,\n        &quot;key_2&quot;: [\n            &quot;value_2_1&quot;,\n            &quot;value_2_2&quot;\n        ]\n    }\n)\n</code></pre>\n<p>and first I'm setting the @json conversion function in front of it:</p>\n<pre><code>@json(\n     '{\n        &quot;key_1&quot;: &quot;value_1&quot;,\n        &quot;key_2&quot;: [\n        &quot;value_2_1&quot;,\n        &quot;value_2_2&quot;\n      ]\n     }'\n)\n</code></pre>\n<p>Here you can see the Execute Pipeline object and its parameters:\n<a href=\"https://i.stack.imgur.com/nuywH.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nuywH.png\" alt=\"\" /></a></p>\n<p>I am setting this JSON as a parameter in the Execute Pipeline object. I am setting its type as an &quot;Array&quot;. (For the record, I have still had similar error messages even though I have tried to change the parameter type to &quot;String&quot; or &quot;Object&quot;.)</p>\n<p>The ForEach activity is used to select an item from the nested JSON, which is written into a parameter.</p>\n<p><a href=\"https://i.stack.imgur.com/hky4Y.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hky4Y.png\" alt=\"\" /></a></p>\n<p>This immediately produces the following error in the Execute Pipeline activity:</p>\n<pre><code>Operation on target... ...failed: The function 'length' expects its parameter to be an array or a string. The provided value is of type 'Object'.\n</code></pre>\n<p>So, <strong>even though I set the JSON parameter type to &quot;Array&quot;, it is changed into &quot;Object&quot; when I debug the pipeline activity.</strong> See the error below:</p>\n<p><a href=\"https://i.stack.imgur.com/TWOT6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/TWOT6.png\" alt=\"\" /></a></p>\n<p>Next, I tried to use the ADF @createArray function before my JSON text.</p>\n<pre><code>@createArray(\n    '{\n        &quot;key_1&quot;: &quot;value_1&quot;,\n        &quot;key_2&quot;: [\n        &quot;value_2_1&quot;,\n        &quot;value_2_2&quot;\n      ]\n     }'\n)\n</code></pre>\n<p>When debugging, the forEach activity throws me an error in the first Copy data activity:</p>\n<pre><code>The expression 'concat(item().SELECTING_key_1_FROM_MY_JSON))' cannot be evaluated because property 'key_1' cannot be selected. Property selection is not supported on values of type 'String'.\n</code></pre>\n<p><a href=\"https://i.stack.imgur.com/kMzgD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/kMzgD.png\" alt=\"\" /></a></p>\n<p><strong>Please help me, what I am doing wrong in my attempts of converting the JSON to an array? What should I change in my code?</strong></p>\n<p>So far I have tried changing the parameter type and using various functions in the JSON dynamic content but with no luck.</p>\n"}