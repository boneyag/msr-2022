{"tags": ["sql", "json", "sql-server", "sql-server-2019", "open-json"], "comments": [{"score": 0, "creation_date": 1587119139, "post_id": 61268901, "comment_id": 108388824, "body": "I am using SQL Server 2019"}], "answers": [{"comments": [{"score": 0, "creation_date": 1587125686, "post_id": 61269812, "comment_id": 108392350, "body": "Is there any easy way to get the count? In the above Json, SP records are one and TP records 4 like that."}, {"score": 0, "creation_date": 1587126079, "post_id": 61269812, "comment_id": 108392563, "body": "well, I don&#39;t know easier way, difficult to handle S, SP, TP ,by which arrays start and because of this, we cannot combine the paths such as $.S.SP.TP at one step @AshokYaganti ."}], "score": 1, "last_activity_date": 1587126538, "last_edit_date": 1587126538, "answer_id": 61269812, "question_id": 61268901, "body": "<p>You can use <code>OPENJSON</code> function containing <code>WITH</code> Clause added as many <code>CROSS APPLY</code> Clause as upto see all sub-arrays :</p>\n\n<pre><code>SELECT S3.TID, S3.TName\n  FROM tab\n CROSS APPLY OPENJSON(JsonData)\n             WITH ( S  nvarchar(max) '$.S' AS JSON) AS S0\n CROSS APPLY OPENJSON (S0.S) \n             WITH (\n                    SP nvarchar(max) '$.SP' AS JSON ) S1\n CROSS APPLY OPENJSON (S1.SP) \n             WITH (\n                    TP nvarchar(max) '$.TP' AS JSON ) S2\n CROSS APPLY OPENJSON (S2.TP) \n             WITH (\n                    TID   nvarchar(500) '$.TID', \n                    TName nvarchar(500) '$.TName' ) S3\n</code></pre>\n\n<p><kbd><a href=\"https://dbfiddle.uk/?rdbms=sqlserver_2019&amp;fiddle=50a3068d9329a458b85f8459e252ccc4\" rel=\"nofollow noreferrer\">Demo</a></kbd></p>\n\n<p><strong>Update :</strong> If the first array <code>S</code> is fixed to contain only one item, we can reduce one-step as</p>\n\n<pre><code>SELECT S3.TID, S3.TName\n  FROM tab\n CROSS APPLY OPENJSON(JsonData)\n             WITH (\n                    SP nvarchar(max) '$.S[0].SP' AS JSON ) S1\n CROSS APPLY OPENJSON (S1.SP) \n             WITH (\n                    TP nvarchar(max) '$.TP' AS JSON ) S2\n CROSS APPLY OPENJSON (S2.TP) \n             WITH (\n                    TID   nvarchar(500) '$.TID', \n                    TName nvarchar(500) '$.TName' ) S3  \n</code></pre>\n\n<p><kbd><a href=\"https://dbfiddle.uk/?rdbms=sqlserver_2019&amp;fiddle=6cfa08d08003a7cad1594281a44eed96\" rel=\"nofollow noreferrer\">Demo</a></kbd></p>\n"}], "is_answered": true, "answer_count": 1, "score": 0, "last_activity_date": 1597388824, "creation_date": 1587117837, "question_id": 61268901, "title": "SQL Query on Json object inside multiple JSON objects", "body": "<p>I have the below Json string. I need to write a query to get the TP records. Without providing the index value, we need get the result.</p>\n\n<pre><code>{\n   \"S\": [\n    {\n      \"Name\": \"Project1\",\n      \"SP\": [\n       {\n          \"ID\": 1,\n          \"Name\": \"Test1\",\n          \"TP\": [\n            {\n              \"TID\": 11,\n              \"TName\": \"TT1\",\n            },\n            {\n              \"TID\": 12,\n              \"TName\": \"TT2\",\n            },\n         ]\n      },\n      {\n        \"ID\": 2,\n        \"Name\": \"Test2\",\n        \"TP\": [\n         {\n          \"TID\": 13,\n          \"TName\": \"TT3\",\n         },\n         {\n          \"TID\": 14,\n          \"TName\": \"TT4\",\n         },\n       ]\n    },\n  ]}]}\n</code></pre>\n\n<p>How do I query to get the TP values.</p>\n\n<p>Expected Result:</p>\n\n<pre><code>  TID    TName \n  11     TT1 \n  12     TT2\n  13     TT3\n  14     TT4\n</code></pre>\n"}