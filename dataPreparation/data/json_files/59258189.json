{"tags": ["javascript", "regex", "google-apps-script"], "comments": [{"score": 0, "creation_date": 1575939316, "post_id": 59258189, "comment_id": 104726574, "body": "Regex is badly suited for tasks like this. You should use javascript&#39;s DOMParser."}, {"score": 0, "creation_date": 1575975332, "post_id": 59258189, "comment_id": 104738913, "body": "Yes I know you&#39;re right. I thought i could only use the DOMParser in a valid html file, as the content of my Google document will be a mix of a few snippets of code and normal text?"}, {"score": 0, "creation_date": 1576030875, "post_id": 59258189, "comment_id": 104762811, "body": "It doesn&#39;t need specifically be valid HTML, just well formed XML. So as long as there&#39;s a single root element and the nested contents follow proper XML syntax, it should be fine."}], "answers": [{"comments": [{"score": 0, "creation_date": 1575986916, "post_id": 59258847, "comment_id": 104745340, "body": "Hi Tanaike, thank you very much for your answer. I will certainly use part of it, but I simplified the description of my issue to focus on 1 problem only: matching <code>&lt;li&gt;...&lt;&#47;li&gt;</code> when <code>...</code> has any character, including new lines. The regex you suggested is considered invalid by Google App Scripts. Any idea?"}, {"score": 0, "creation_date": 1575988914, "post_id": 59258847, "comment_id": 104746570, "body": "I might be out of luck: <a href=\"https://stackoverflow.com/questions/37771381/eliminate-newlines-in-google-app-script-using-regex\" title=\"eliminate newlines in google app script using regex\">stackoverflow.com/questions/37771381/&hellip;</a>"}, {"score": 0, "creation_date": 1576017160, "post_id": 59258847, "comment_id": 104759595, "body": "@Greg Forel Thank you for replying. I have to apologize for my poor English skill. Unfortunately, I cannot understand about your current issue of <code>The regex you suggested is considered invalid by Google App Scripts.</code>. Because in my test, your sample values can be used with the sample script. So can you explain about the detail information of it? I would like to think of it."}, {"score": 0, "creation_date": 1576070196, "post_id": 59258847, "comment_id": 104778521, "body": "sorry, your regex does work. I made a mistake using it. This is helpful to solve my problem, thanks again!"}, {"score": 0, "creation_date": 1576103989, "post_id": 59258847, "comment_id": 104794755, "body": "@Greg Forel Thank you for replying. I&#39;m glad your issue was resolved. If your question was solved, please push an accept button. Other people who have the same issue with you can also base your question as a question which can be solved. And I think that your issue and solution will be useful for them. If you don&#39;t find the button, feel free to tell me. <a href=\"https://stackoverflow.com/help/accepted-answer\">stackoverflow.com/help/accepted-answer</a>"}], "score": 2, "last_activity_date": 1575940541, "answer_id": 59258847, "question_id": 59258189, "body": "<ul>\n<li>You want to retrieve the text of <code>&lt;li ...&gt;....&lt;/li&gt;</code> in Google Document.</li>\n<li>You want to achieve this using Google Apps Script.</li>\n</ul>\n\n<p>If my understanding is correct, how about this answer? Please think of this as just one of several possible answers.</p>\n\n<h3>Issue and workaround:</h3>\n\n<p>In your case, you want to use the pattern of <code>&lt;li sheet=\"[a-zA-Z0-9]*\"&gt;[\\s\\S]*?&lt;\\/li&gt;</code>, please modify to <code>&lt;li sheet=\"[a-zA-Z0-9]*\"&gt;[\\\\s\\\\S]*?&lt;\\/li&gt;</code>. In your case, <code>&lt;li ...&gt;....&lt;/li&gt;</code> has several paragraphs. (From your sample value, I thought like this.) By this, when the pattern of <code>const searchPattern = '&lt;li sheet=\"[a-zA-Z0-9]*\"&gt;[\\\\s\\\\S]*?&lt;\\/li&gt;'</code> is used for <code>body.findText(searchPattern)</code>, <code>null</code> is returned. If <code>&lt;li ...&gt;....&lt;/li&gt;</code> is put as one paragraph, <code>body.findText(searchPattern)</code> returns <code>&lt;li ...&gt;....&lt;/li&gt;</code>.</p>\n\n<p>In order to search <code>&lt;li ...&gt;....&lt;/li&gt;</code> which has several paragraphs, how about the following workaround? The flow of this workaround is as follows.</p>\n\n<h3>Flow:</h3>\n\n<ol>\n<li>Use <code>&lt;li sheet=</code> and <code>&lt;\\/li&gt;</code> as patterns for searching.</li>\n<li>Using the pattern of <code>&lt;li sheet=</code>, retrieve the begin paragraph of <code>&lt;li ...&gt;</code>.</li>\n<li>Using the pattern of <code>&lt;\\/li&gt;</code>, retrieve the end paragraph of <code>&lt;/li&gt;</code>.</li>\n<li>Retrieve the texts between the retrieved begin and end paragraph.</li>\n<li>This cycle is continued until all <code>&lt;li ...&gt;....&lt;/li&gt;</code> values are searched.</li>\n</ol>\n\n<h3>Sample script:</h3>\n\n<pre><code>function parseLists(body) {\n  // var doc = DocumentApp.getActiveDocument();\n  // var body = doc.getBody();\n\n  var pattern1 = \"&lt;li sheet=\";\n  var pattern2 = \"&lt;\\/li&gt;\";\n  var range1 = body.findText(pattern1);\n  var res = [];\n  while (range1) {\n    var temp = {};\n    var p1 = range1.getElement().getParent();\n    temp.startIndex = body.getChildIndex(p1);\n    var range2;\n    if (p1) {\n      range2 = body.findText(pattern2, range1);\n      var p2 = range2.getElement().getParent();\n      temp.endIndex = body.getChildIndex(p2) + 1;\n      var texts = \"\";\n//      for (var i = temp.startIndex + 1; i &lt; temp.endIndex - 1; i++) {\n      for (var i = temp.startIndex; i &lt; temp.endIndex; i++) {\n        texts += body.getChild(i).asParagraph().getText();\n      }\n      temp.texts = texts;\n      res.push(temp);\n    }\n    range1 = body.findText(pattern1, range2);\n  }\n  Logger.log(res)\n}\n</code></pre>\n\n<h3>Result:</h3>\n\n<p>When your sample values are put to new Google Document and run the script, the following result is retrieved.</p>\n\n<pre><code>[\n  {\n    \"startIndex\": 0,\n    \"endIndex\": 5,\n    \"texts\": \"&lt;li sheet=\\\"experiences\\\"&gt;{{company_name}},  {{job_location}} \u2014 {{job_title}}MONTH {{from}} - {{to}}{{description}}&lt;/li&gt;\"\n  },\n  {\n    \"startIndex\": 6,\n    \"endIndex\": 9,\n    \"texts\": \"&lt;li sheet=\\\"other\\\"&gt;{{test}}&lt;/li&gt;\"\n  }\n]\n</code></pre>\n\n<ul>\n<li><p>For above result, if you want to retrieve the values of <code>{{company_name}},  {{job_location}} \u2014 {{job_title}}MONTH {{from}} - {{to}}{{description}}</code> and <code>{{test}}</code> without the tags, please modify above script as follows.</p>\n\n<ul>\n<li><p>From:</p>\n\n<pre><code>for (var i = temp.startIndex; i &lt; temp.endIndex; i++) {\n</code></pre></li>\n<li><p>To:</p>\n\n<pre><code>for (var i = temp.startIndex + 1; i &lt; temp.endIndex - 1; i++) {\n</code></pre></li>\n</ul></li>\n</ul>\n\n<h3>References:</h3>\n\n<ul>\n<li><a href=\"https://developers.google.com/apps-script/reference/document/text#findtextsearchpattern,-from\" rel=\"nofollow noreferrer\">findText(searchPattern, from)</a></li>\n<li><a href=\"https://developers.google.com/apps-script/reference/document/body#getchildindexchild\" rel=\"nofollow noreferrer\">getChildIndex(child)</a></li>\n<li><a href=\"https://developers.google.com/apps-script/reference/document/text#getparent\" rel=\"nofollow noreferrer\">getParent()</a></li>\n</ul>\n\n<p>If I misunderstood your question and this was not the direction you want, I apologize.</p>\n"}], "is_answered": true, "answer_count": 1, "score": 0, "last_activity_date": 1575986741, "creation_date": 1575934711, "question_id": 59258189, "title": "Google App Scripts regex body.findText(searchPattern) returns null if new lines", "body": "<p>Here's a Google Document content:</p>\n\n<pre><code>Some text, more text...\n\n&lt;li&gt;\nsome lines\nmore lines...\n&lt;/li&gt;\n\nAnd more text\n</code></pre>\n\n<p>I would like a <code>regex</code> to match:</p>\n\n<pre><code>&lt;li&gt;\n...\n&lt;/li&gt;\n</code></pre>\n\n<p>So far it returns <code>null</code>. My regex only finds <code>&lt;li&gt;...&lt;/li&gt;</code>, but not with new lines, although I am using the <code>(?s)</code> tag suggested to ensure that <code>.</code> includes any character and new lines:</p>\n\n<p><code>(?s)&lt;li&gt;(.)*?&lt;/li&gt;</code></p>\n\n<p>My regex works in <a href=\"https://regexr.com/\" rel=\"nofollow noreferrer\">https://regexr.com/</a> and <a href=\"https://regex101.com/\" rel=\"nofollow noreferrer\">https://regex101.com/</a>, so I don't understand it doesn't in Google App Script.</p>\n"}