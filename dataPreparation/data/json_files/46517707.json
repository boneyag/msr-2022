{"tags": ["php", "json", "api", "codeigniter"], "answers": [{"score": 0, "last_activity_date": 1506899907, "answer_id": 46517795, "question_id": 46517707, "body": "<p>I prefer <a href=\"https://usercountry.com/v1.0/json/\" rel=\"nofollow noreferrer\">https://usercountry.com/v1.0/json/</a>. Here is an example below:</p>\n\n<pre><code>$chs = curl_init('https://usercountry.com/v1.0/json/'.$this-&gt;input-&gt;ip_address());\ncurl_setopt($chs, CURLOPT_FAILONERROR, TRUE);\ncurl_setopt($chs, CURLOPT_RETURNTRANSFER, TRUE);\ncurl_setopt($chs, CURLOPT_SSL_VERIFYPEER, 0);\n\n$geolocation = curl_exec($chs);\n$geolocation = json_decode($geolocation, true);\n\n$state = $geolocation['region']['state'];\n$country = $geolocation['country']['name'];\n$country_code = $geolocation['country']['alpha-2']; //if you want 3 letters like USA, try alpha-3\n</code></pre>\n\n<p>Now, you can insert (or update) your data:</p>\n\n<pre><code>$data = [\n  'state' =&gt; $state,\n  'country' =&gt; $country,\n  'country_code' =&gt; $country_code,\n  'ip_address' =&gt; $this-&gt;input-&gt;ip_address(),\n  'timestamp' =&gt; time(),\n  'user_id' =&gt; $your_user_id_variable\n];\n$this-&gt;db-&gt;insert('your_table_name', $data);\n</code></pre>\n\n<p>That's all! If you want to see a sample output for <a href=\"https://usercountry.com/v1.0/json/\" rel=\"nofollow noreferrer\">https://usercountry.com/v1.0/json/</a>, please add your (or another) IP address and paste it to your address bar. (e.g: <a href=\"https://usercountry.com/v1.0/json/46.102.103.10\" rel=\"nofollow noreferrer\">https://usercountry.com/v1.0/json/46.102.103.10</a>)</p>\n"}], "is_answered": false, "answer_count": 1, "score": 0, "last_activity_date": 1506899907, "creation_date": 1506898999, "question_id": 46517707, "title": "geolocation - Identifying country by IP address", "body": "<p>I want to implement log browser,ip,user,timestamp, but I want to add country,and state. I was trying to add some parameters from \n<a href=\"http://api.ipinfodb.com/\" rel=\"nofollow noreferrer\">http://api.ipinfodb.com/</a> , but it doesn't because I only need to add to my default function json country code , country and state from the api , but I cant add it . I have an json with 600+ rows I need to store depends on the ip country , state and region. \ncontroller </p>\n\n<pre><code>public function datatable(){\n        $array = $this-&gt;sessions-&gt;datatable();\n        $this-&gt;json($array);\n        $data = array();\n        foreach ($array as $rows){\n            $user_agent = $this-&gt;getBrowser($rows['user_agent']);\n            array_push($data, array(\n                $user_agent['name'].' on '.$user_agent['platform'],\n                $rows['ip_address'],\n                date('m/d/Y H:i:s',$rows['timestamp']),\n            ));\n        }\n        $this-&gt;json(array('data' =&gt; $data));\n    }\n\n    public function tests()\n    {\n        $ip = '200.92.39.106';\n        $this-&gt;load-&gt;config('geolocation', true);\n        $config = $this-&gt;config-&gt;config['geolocation'];\n        $this-&gt;geolocation-&gt;initialize($config);\n        $this-&gt;geolocation-&gt;set_ip_address($ip);\n\n        $city = $this-&gt;geolocation-&gt;get_city();\n        if($city === FALSE)\n            echo $this-&gt;geolocation-&gt;get_error();\n        else\n            echo $city;\n    }\n</code></pre>\n"}