{"tags": ["javascript", "json"], "comments": [{"score": 0, "creation_date": 1561242502, "post_id": 56719581, "comment_id": 100000491, "body": "exactly the same as the JSON response. Click: <a href=\"https://ipinfo.io/json\" rel=\"nofollow noreferrer\">ipinfo.io/json</a> to see how it looks like (won&#39;t share the exact response due to privacy reasons)"}], "answers": [{"comments": [{"score": 0, "creation_date": 1561242921, "post_id": 56719631, "comment_id": 100000534, "body": "You are absolutely right, but do then have any clue why my code redirects me to url/[object%20Object] and before displays &quot;undefined&quot; at the p-tag when I use &quot;location = response;&quot;? @ggorlen"}, {"score": 0, "creation_date": 1561243254, "post_id": 56719631, "comment_id": 100000574, "body": "I&#39;m betting it has something to do with your use of <code>document.querySelector(&#39;.location&#39;).innerHTML = location.city;</code>. Maybe that&#39;s resolving to document.location? Rewriting the document location can cause a reload of the page."}, {"score": 0, "creation_date": 1561243491, "post_id": 56719631, "comment_id": 100000606, "body": "@darrin tested it. Thank you! Works now with another name for the variable :)"}, {"score": 0, "creation_date": 1561243536, "post_id": 56719631, "comment_id": 100000615, "body": "Yeah, you&#39;re using the global location. If you use <code>let</code>, you&#39;ll get an error that the variable has already been defined."}], "score": 1, "last_activity_date": 1561243955, "last_edit_date": 1561243955, "answer_id": 56719631, "question_id": 56719581, "body": "<p>Your response data is already parsed into a JS object due to the Content-Type type of the response header; you should use the response object directly:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>$.get(\"https://ipinfo.io/json\", function (response) {\r\n  document.querySelector('.location').innerHTML = response.city;\r\n});</code></pre>\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js\"&gt;&lt;/script&gt;\r\n\r\n&lt;p class=\"location\"&gt;&lt;/p&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>The error you're seeing when you attempt to parse the object is due to <code>JSON.parse()</code> calling <code>object.toString()</code>, which returns <code>\"[object Object]\"</code>:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>const obj = {};\r\n\r\nconsole.log(obj.toString()); // \"[object Object]\"\r\nJSON.parse(obj); // Unexpected token o in JSON at position 1</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>As for your confusing redirect, the cause is the global <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/location\" rel=\"nofollow noreferrer\"><code>Window.location</code></a> variable. Using <code>let location;</code> would reveal that you're setting an existing variable, throwing the error <code>\"Uncaught SyntaxError: Identifier 'location' has already been declared\"</code>. Using a different variable name solves the issue.</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>let location; // Uncaught SyntaxError: Identifier 'location' has already been declared\r\n\r\nlocation = \"foo bar\";</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}], "is_answered": true, "answer_count": 1, "score": 1, "last_activity_date": 1567889952, "creation_date": 1561242090, "question_id": 56719581, "title": "Unable to set JSON response as a var neither with nor without JSON.parse()", "body": "<p>I am setting a little website that among other things (importantly for this problem) saves your current location data in a var, which it retrieves from the ipinfo API (<a href=\"https://ipinfo.io/json\" rel=\"nofollow noreferrer\">https://ipinfo.io/json</a>)</p>\n\n<p>I tried using JSON.parse() which solved the problem of my website displaying \"undefined\" at the p-tag where the location is normally displayed before redirecting me to url/[object%20Object] after half a second. With parse I get the following error console.log: (see further down)</p>\n\n<p>The JSON response can be used without saving without causing any problems. To see how it looks like click the API link above.</p>\n\n<p>Here is my JS code:</p>\n\n<pre><code>var location;\n\n// called when the document is fully loaded\n$(document).ready(function(){\n\n    // gets your current location data and displays it\n    $.get(\"https://ipinfo.io/json\", function(response) {\n\n        location = JSON.parse(response);\n        console.log(location);\n        document.querySelector('.location').innerHTML = location.city;\n\n    });\n</code></pre>\n\n<p>Here is the HTML:</p>\n\n<pre><code>&lt;h4&gt;You are playing from:&lt;/h4&gt;\n&lt;div&gt;\n    &lt;p class=\"location\"&gt;&lt;/p&gt;\n    &lt;p class=\"country\"&gt;&lt;/p&gt;\n    &lt;p class=\"region\"&gt;&lt;/p&gt;\n&lt;/div&gt;\n&lt;div class=\"row\"&gt;\n  &lt;div class=\"column\"&gt;\n      &lt;h3&gt;Column 1&lt;/h3&gt;\n      &lt;p id=\"city_a\"&gt;\n      &lt;/p&gt;\n  &lt;/div&gt;\n  &lt;div class=\"column\"&gt;\n      &lt;h3&gt;Column 2&lt;/h3&gt;\n      &lt;p id=\"city_b\"&gt;\n      &lt;/p&gt;\n  &lt;/div&gt;\n</code></pre>\n\n<p>This is the error in the console I get:</p>\n\n<blockquote>\n  <p>VM102:1 Uncaught SyntaxError: Unexpected token o in JSON at position 1  </p>\n  \n  <p>at JSON.parse ()<br>\n  at Object.success ((index):64)<br>\n  at u (VM94 jquery-3.3.1.min.js:2)<br>\n  at Object.fireWith [as resolveWith] (VM94 jquery-3.3.1.min.js:2)<br>\n  at k (VM94 jquery-3.3.1.min.js:2)<br>\n  at XMLHttpRequest. (VM94 jquery-3.3.1.min.js:2)</p>\n</blockquote>\n\n<p>Anything would help :) Thanks in advance!</p>\n"}