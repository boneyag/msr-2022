{"tags": ["php", "json", "curl", "docusignapi"], "comments": [{"score": 0, "creation_date": 1457633370, "post_id": 35923863, "comment_id": 59506435, "body": "you&#39;re doing curl uploads all wrong (or, even if you&#39;re technically doing it correct, which i doubt,  you&#39;re doing it in a very error-prone way), don&#39;t set content-length, curl will do it for you, and don&#39;t write the normal HTTP POST multipart/form-data upload request body manually, again, let curl do it for you, with CURLFile. also you&#39;re sending too many \\r\\n&#39;s because curl will add \\r\\n\\r\\n to separate HTTP HEADERS with HTTP BODY per the http specs automatically, so what you&#39;re sending now is probably \\r\\n\\r\\n\\r\\n\\r\\n which corrupts the request body"}, {"score": 0, "creation_date": 1457634420, "post_id": 35923863, "comment_id": 59507107, "body": "ohhh, are you doing it because the &quot;documentid&quot; in Content-disposition which can&#39;t be set with CURLFile? that&#39;d explain it.."}], "answers": [{"comments": [{"score": 0, "creation_date": 1457879051, "post_id": 35961310, "comment_id": 59596904, "body": "That did it! Thank you so much!!"}], "score": 2, "last_activity_date": 1457805487, "answer_id": 35961310, "question_id": 35923863, "body": "<p>When obtaining the recipient view (the signing view), try identifying the signer by just specifying the </p>\n\n<pre><code>\"email\" =&gt; $email, # signer's email\n\"userName\" =&gt; $recipientName,\n\"clientUserId\" =&gt; $clientUserId\n</code></pre>\n\n<p>as shown in the embedded signing recipe.</p>\n\n<p>Don't set the <code>userId</code></p>\n"}], "is_answered": true, "answer_count": 1, "score": 1, "last_activity_date": 1457805487, "creation_date": 1457632646, "question_id": 35923863, "title": "Docusign REST API Getting recipient URL for document envelope", "body": "<p>I have a web app that takes a user through a series of forms and then generates a pdf with their answers. I want to add a Docusign signature to the end of the pdf form, so that after finishing the online form they are asked to sign it in an iframe.</p>\n\n<p>I started with this doc - <a href=\"https://www.docusign.com/developer-center/recipes/signing-from-your-app\" rel=\"nofollow\">https://www.docusign.com/developer-center/recipes/signing-from-your-app</a> and then took step 2 from this doc to create my envelope with a document - <a href=\"https://www.docusign.com/developer-center/recipes/request-a-signature-via-email\" rel=\"nofollow\">https://www.docusign.com/developer-center/recipes/request-a-signature-via-email</a></p>\n\n<p>My code created the Envelope ID fine, but when I try to get the URL using <code>/envelopes/$envelopeId/views/recipient</code> I get the status 400 error:</p>\n\n<pre><code>{ \"errorCode\": \"ACCOUNT_NOT_AUTHORIZED_FOR_ENVELOPE\", \"message\": \"This account is not authorized to access the requested envelope.\" }\n</code></pre>\n\n<p>Here is my full code below:</p>\n\n<pre><code>&lt;?php\n\n$docusign_username = \"my@username.com\";\n$docusign_password = \"mypassword\";\n$docusign_integrator_key = \"my-integrator-key\";\n\n$applicant_email = \"johnsmith@emailaddress.com\";\n$applicant_name = \"John Smith\";\n$applicant_unique_id = \"123\";\n\n$application_unique_id = \"31587\";\n$application_form_pdf = \"31587.pdf\";\n\n// construct the authentication header:\n$header = \"&lt;DocuSignCredentials&gt;&lt;Username&gt;\" . $docusign_username . \"&lt;/Username&gt;&lt;Password&gt;\" . $docusign_password . \"&lt;/Password&gt;&lt;IntegratorKey&gt;\" . $docusign_integrator_key . \"&lt;/IntegratorKey&gt;&lt;/DocuSignCredentials&gt;\";\n\n//////////////////////////////////////////////////////////////////////////////////////\n// STEP 1 - Login (retrieves baseUrl and accountId)\n//////////////////////////////////////////////////////////////////////////////////////\n$url = \"https://demo.docusign.net/restapi/v2/login_information\";\n$curl = curl_init($url);\ncurl_setopt($curl, CURLOPT_HEADER, false);\ncurl_setopt($curl, CURLOPT_RETURNTRANSFER, true);\ncurl_setopt($curl, CURLOPT_HTTPHEADER, array(\"X-DocuSign-Authentication: $header\"));\n\n$json_response = curl_exec($curl);\n$status = curl_getinfo($curl, CURLINFO_HTTP_CODE);\n\nif ( $status != 200 ) {\n    echo \"error calling webservice, status is:\" . $status;\n    exit(-1);\n}\n\n$response = json_decode($json_response, true);\n$accountId = $response[\"loginAccounts\"][0][\"accountId\"];\n$baseUrl = $response[\"loginAccounts\"][0][\"baseUrl\"];\ncurl_close($curl);\n\n//--- display results\necho \"accountId = \" . $accountId . \"\\nbaseUrl = \" . $baseUrl . \"\\n\";\n\n\n//////////////////////////////////////////////////////////////////////////////////////\n// STEP 2 - Create an envelope with document\n//////////////////////////////////////////////////////////////////////////////////////\n$data =\n    array (\n        \"emailSubject\" =&gt; \"DocuSign API - Please sign \" . $application_form_pdf,\n        \"documents\" =&gt; array(\n            array(\"documentId\" =&gt; $application_unique_id, \"name\" =&gt; $application_form_pdf)\n            ),\n        \"recipients\" =&gt; array(\n            \"signers\" =&gt; array(\n                array(\n                    \"email\" =&gt; $applicant_email,\n                    \"name\" =&gt; $applicant_name,\n                    \"clientUserId\" =&gt; $applicant_unique_id,\n                    \"recipientId\" =&gt; $applicant_unique_id,\n                    \"tabs\" =&gt; array(\n                        \"signHereTabs\" =&gt; array(\n                            array(\n                                \"xPosition\" =&gt; \"100\",\n                                \"yPosition\" =&gt; \"100\",\n                                \"documentId\" =&gt; $application_unique_id,\n                                \"pageNumber\" =&gt; \"1\"\n                            )\n                        )\n                    )\n                )\n            )\n        )\n    , \"status\" =&gt; \"sent\"\n    // , \"status\" =&gt; \"created\"\n);\n$data_string = json_encode($data);\n$file_contents = file_get_contents($application_form_pdf);\n\n// Create a multi-part request. First the form data, then the file content\n$requestBody =\n     \"\\r\\n\"\n    .\"\\r\\n\"\n    .\"--myboundary\\r\\n\"\n    .\"Content-Type: application/json\\r\\n\"\n    .\"Content-Disposition: form-data\\r\\n\"\n    .\"\\r\\n\"\n    .\"$data_string\\r\\n\"\n    .\"--myboundary\\r\\n\"\n    .\"Content-Type:application/pdf\\r\\n\"\n    .\"Content-Disposition: file; filename=\\\"$application_form_pdf\\\"; documentid=\".$application_unique_id.\" \\r\\n\"\n    .\"\\r\\n\"\n    .\"$file_contents\\r\\n\"\n    .\"--myboundary--\\r\\n\"\n    .\"\\r\\n\";\n\n// Send to the /envelopes end point, which is relative to the baseUrl received above.\n$curl = curl_init($baseUrl . \"/envelopes\" );\ncurl_setopt($curl, CURLOPT_RETURNTRANSFER, true);\ncurl_setopt($curl, CURLOPT_POST, true);\ncurl_setopt($curl, CURLOPT_POSTFIELDS, $requestBody);\ncurl_setopt($curl, CURLOPT_HTTPHEADER, array(\n    'Content-Type: multipart/form-data;boundary=myboundary',\n    'Content-Length: ' . strlen($requestBody),\n    \"X-DocuSign-Authentication: $header\" )\n);\n$json_response = curl_exec($curl); // Do it!\n\n$status = curl_getinfo($curl, CURLINFO_HTTP_CODE);\nif ( $status != 201 ) {\n    echo \"Error calling DocuSign, status is:\" . $status . \"\\nerror text: \";\n    print_r($json_response); echo \"\\n\";\n    exit(-1);\n}\n\n$response = json_decode($json_response, true);\n$envelopeId = $response[\"envelopeId\"];\n\n//--- display results\necho \"Envelope created! Envelope ID: \" . $envelopeId . \"\\n\";\n\n//////////////////////////////////////////////////////////////////////////////////////\n// STEP 3 - Get the Embedded Signing View\n//////////////////////////////////////////////////////////////////////////////////////\n$data = array(\n      \"returnUrl\" =&gt; \"https://www.docusign.com/devcenter\"\n    , \"authenticationMethod\" =&gt; \"None\"\n    , \"authenticationInstant\" =&gt; \"None\"\n    , \"userId\" =&gt; $applicant_unique_id\n    , \"clientUserId\" =&gt; $applicant_unique_id\n    // , \"email\" =&gt; $applicant_email\n    // , \"userName\" =&gt; $applicant_name\n);\n\n$data_string = json_encode($data);\n$curl = curl_init($baseUrl.\"/envelopes/$envelopeId/views/recipient\" );\ncurl_setopt($curl, CURLOPT_RETURNTRANSFER, true);\ncurl_setopt($curl, CURLOPT_POST, true);\ncurl_setopt($curl, CURLOPT_POSTFIELDS, $data_string);\ncurl_setopt($curl, CURLOPT_HTTPHEADER, array(\n    'Content-Type: application/json',\n    'Content-Length: ' . strlen($data_string),\n    \"X-DocuSign-Authentication: $header\" )\n);\n\n$json_response = curl_exec($curl);\n$status = curl_getinfo($curl, CURLINFO_HTTP_CODE);\nif ( $status != 201 ) {\n    echo \"error calling webservice, status is:\" . $status . \"\\nerror text is --&gt; \";\n    print_r($json_response); echo \"\\n\";\n    exit(-1);\n}\n\n$response = json_decode($json_response, true);\n$url = $response[\"url\"];\n\n//--- display results\necho \"Embedded URL is: \\n\\n\" . $url . \"\\n\\nNavigate to this URL to start the embedded signing view of the envelope\\n\";\n\n?&gt;\n</code></pre>\n\n<p>Any ideas would be gratefully received, thanks!</p>\n"}