{"tags": ["python", "django", "django-views", "django-forms"], "comments": [{"post_id": 68434956, "comment_id": 120946660, "body": "What to do you mean by redirecting to the next page in case of an unsuccessful login? Could you please be a bit more specific about your requirements?"}, {"post_id": 68434956, "comment_id": 120955910, "body": "Page which is mention in next hidden field in login form."}, {"post_id": 68434956, "comment_id": 120956006, "body": "how do you think users will visit this link? I can&#39;t seem to any bit of <code>javascript</code> in the above snippets that do this for you?"}, {"post_id": 68434956, "comment_id": 120956178, "body": "There is not any javascript. All I want to do if user is not authorized then redirect to another url rather than login page."}, {"post_id": 68434956, "comment_id": 120956423, "body": "okay, you will have to do that from your <code>view</code> function. Can you please post your complete <code>view</code> function which is handling this request?"}, {"post_id": 68434956, "comment_id": 120957011, "body": "I have add complete view function."}], "answers": [{"answer_id": 68441977, "question_id": 68434956, "body": "<p>In case you want to redirect a user who couldn't log in to a different page, one of the ways that you may do it is:</p>\n<pre class=\"lang-py prettyprint-override\"><code>from django.contrib import messages\nfrom django.contrib.auth import authenticate, login\nfrom django.shortcuts import redirect\n\ndef login(request, template_path='login.html'):\n    if request.user.is_authenticated:\n         redirect('home')\n\n    user = authenticate(request, username= request.POST.get('username'), password=request.POST.get('password'))\n    if user is not None:\n          next_url = request.POST.get('next') # get your next url\n          messages.error(request, _('Invalid credentials')) # display login error on the next page\n          return redirect(next_url)\n    else:\n         login(request, user)\n         # redirect to the successful url that you wish to\n\n</code></pre>\n<p>For more information on displaying messages in your template, you may consult <a href=\"https://docs.djangoproject.com/en/3.2/ref/contrib/messages/#displaying-messages\" rel=\"nofollow noreferrer\">django's documentation</a></p>\n"}], "is_answered": true, "answer_count": 1, "last_activity_date": 1626707044, "question_id": 68434956, "title": "Django after login failed page is not redirecting to next", "body": "<p>If user do successfull login then it is redirecting to next but if user can not do login then I wants to change template and wants to redirect to next page but it is not working.</p>\n<p>Views.py</p>\n<pre><code>def login(request, template_path='login.html'):\n&quot;&quot;&quot;\n&quot;&quot;&quot;\n# We'll only allow staff to view this page after login.\nif request.user.is_authenticated:\n    return redirect('home')\n\nif request.method == 'POST':\n\n if request.META['HTTP_REFERER'].split('/')[-1] == 'bs5':\n        template_path = 'theme/bs5_theme.html'\n\n    response = LoginView.as_view(\n        template_name=template_path,\n        redirect_field_name='next',\n        form_class=EmailAuthenticationForm,\n    )(request)\n\n    if request.is_ajax():\n        if request.user.is_authenticated:\n            return HttpResponse(\n                json.dumps(dict(success=True, next=request.POST.get(&quot;next&quot;))),\n                content_type=&quot;application/json&quot;\n            )\n        return HttpResponse(json.dumps(False), content_type=&quot;application/json&quot;)\n    else:\n        return response\nelse:\n    form = auth_forms.AuthenticationForm()\n    model = dict(login_form=form)\n    return render(request, template_path, model)\n</code></pre>\n<p>login.html</p>\n<pre><code>    {% if form.non_field_errors %}\n                &lt;div class=&quot;alert alert-danger alert-dismissible fade show&quot; role=&quot;alert&quot;&gt;\n                    &lt;button type=&quot;button&quot; class=&quot;btn-close&quot; data-bs-dismiss=&quot;alert&quot; aria-label=&quot;Close&quot;&gt;&lt;/button&gt;\n                    Login failed. Email and password case-sensitive.\n                &lt;/div&gt;\n    {% endif %}  \n&lt;form id=&quot;formLogin&quot; action=&quot;{% url 'login' %}&quot; method=&quot;post&quot; role=&quot;form&quot;&gt;\n            &lt;input type=&quot;hidden&quot; name=&quot;csrfmiddlewaretoken&quot;&gt;\n            &lt;input type=&quot;hidden&quot; name=&quot;next&quot; value=&quot;/bs5&quot; /&gt;\n            &lt;label for=&quot;id_username&quot; class=&quot;form-label&quot;&gt;Email address&lt;/label&gt;\n            &lt;input type=&quot;username&quot; class=&quot;form-control&quot; id=&quot;id_username&quot; name=&quot;username&quot; value=&quot;{{ form.username.value }}&quot;&gt;\n            &lt;label for=&quot;id_password&quot; class=&quot;form-label&quot;&gt;Password&lt;/label&gt;\n            &lt;input type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;id_password&quot; name=&quot;password&quot;&gt;\n            &lt;button class=&quot;btn btn-primary btn-lg&quot; type=&quot;submit&quot;&gt;Log In&lt;/button&gt;\n&lt;/form&gt;\n</code></pre>\n<p>I have also try with</p>\n<pre><code>return HttpResponseRedirect('/bs5')\n</code></pre>\n<p>But then it is not showing login error.</p>\n<p>Any help would be appreciated.</p>\n"}